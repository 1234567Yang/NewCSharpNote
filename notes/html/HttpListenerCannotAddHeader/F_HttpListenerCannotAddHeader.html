<!DOCTYPE html>
<html>
    <head>
		<meta charset="UTF-8">
        <meta name="keywords" content="C# HttpListener, C# HttpListener 协议头,  C# HttpListener Header,  C# HttpListener 协议头无法添加">
        <meta name="description" content="C# HttpListener 添加协议头无效且不报错解决方案">
        <title>C# HttpListener 添加协议头无效且不报错解决方案</title>

        <link rel="icon" href="../../../static/image/favicon.ico">
		
		
		
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4204717380896480"
     crossorigin="anonymous"></script>

     
        <script type="text/javascript" src="../../../static/res/codemirror_6.65.7_codemirror.min.js"></script>
        <script type="text/javascript" src="../../../static/res/codemirror_codemirror5_mode_clike_clike.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../static/res/codemirror_6.65.7_codemirror.min.css">
        <link rel="stylesheet" type="text/css" href="../../../static/res/codemirror_theme_ambiance.css">
        

        
        <script type="text/javascript" src="../../../static/res/require_2.3.5_minified.js"></script>
        <script type="text/javascript" src="../../../static/res/load.js"></script>
        <script type="text/javascript">
            window.onload = function() {
                load();
            }
        </script>


        <link rel="stylesheet" type="text/css" href="../../../static/res/model.css">
    </head>
    <body>
        <div class="header header-footer">
            <span id="header-hint">笔记 - C# HttpListener 添加协议头无效且不报错解决方案</span>
            <img src="../../../static/image/LanHua.png" id="header-img">
        </div>
		<br>
		<br>
        <br>
		<p id="announcement"></p>
        <div class="content">
            <p>记录一个<code>Header</code>无法被添加进<code>response</code>的大坑。</p>
<p>平时似乎没怎么注意。</p>
<p>这样是不行的：</p>
<textarea class="codeTextarea">
byte[] buffer = Encoding.UTF8.GetBytes(ImageOperation.ChangeImageToString(ImageToByte(PartImage.ExtractRegionFromImage(ScreenShot(), change[0]))));
response.ContentLength64 = buffer.Length;
response.OutputStream.Write(buffer, 0, buffer.Length);

response.Headers.Set("Change", "1");
response.Headers.Set("X", change[0].X.ToString());
response.Headers.Set("Y", change[0].Y.ToString());
response.Headers.Set("W", change[0].Width.ToString());
response.Headers.Set("H", change[0].Height.ToString());
</textarea>
<p>得这样：</p>
<textarea class="codeTextarea">
response.Headers.Set("Change", "1");
response.Headers.Set("X", change[0].X.ToString());
response.Headers.Set("Y", change[0].Y.ToString());
response.Headers.Set("W", change[0].Width.ToString());
response.Headers.Set("H", change[0].Height.ToString());


byte[] buffer = Encoding.UTF8.GetBytes(ImageOperation.ChangeImageToString(ImageToByte(PartImage.ExtractRegionFromImage(ScreenShot(), change[0]))));
response.ContentLength64 = buffer.Length;
response.OutputStream.Write(buffer, 0, buffer.Length);
</textarea>


<b>坑！要先写入Header。</b>
        </div>
        <br>
        <div class="footer header-footer">
            <span>Made by 1234567Yang</span>
            <span>
                在<a href="https://github.com/1234567Yang/CSharpNote/">GitHub</a>上查看源代码
            </span>
        </div>
    </body>
</html>